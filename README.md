# ESP32-C6 LCD - Монитор мощности из Home Assistant

Проект для ESP32-C6 LCD с встроенным экраном, который получает данные о мощности из Home Assistant через REST API и отображает их на встроенном LCD дисплее.

## Особенности

- ✅ Встроенный LCD экран 172×320 пикселей - ничего подключать не надо!
- ✅ Красивый интерфейс на LVGL
- ✅ Получение данных из Home Assistant через REST API
- ✅ Автоматическое переподключение к WiFi
- ✅ Обновление данных каждую минуту

## Настройка

1. Открой `src/main.cpp` и настрой:

   **WiFi:**
   - `ssid` - название твоей WiFi сети
   - `password` - пароль от WiFi

   **Home Assistant REST API:**
   - `ha_server` - IP адрес или доменное имя твоего Home Assistant (например, `192.168.1.100` или `hass.home.local`)
   - `ha_port` - порт Home Assistant (обычно `8123`, или `80` если через reverse proxy)
   - `ha_token` - Long-Lived Access Token из Home Assistant
   - `ha_entity_id` - Entity ID сенсора мощности (например, `sensor.conditioner_socket_power`)

2. **Как получить Long-Lived Access Token:**
   - Зайди в Home Assistant
   - Профиль (внизу слева) → Прокрути вниз → "Токены долгоживущих токенов"
   - Нажми "Создать токен"
   - Скопируй токен и вставь в `ha_token`

3. **Как найти Entity ID:**
   - В Home Assistant: Настройки → Устройства и службы → Zigbee2MQTT (или другой интегратор)
   - Найди свою розетку и открой сенсор мощности
   - Entity ID будет указан вверху (например, `sensor.conditioner_socket_power`)

4. **Настрой порт в `platformio.ini`:**
   - Если твой ESP32-C6 подключен к другому COM порту, измени `upload_port` и `monitor_port`

## Компиляция и загрузка

```bash
pio run -t upload
```

## Мониторинг

```bash
pio device monitor
```

## Что делает

- Подключается к WiFi
- При старте сразу запрашивает текущее значение мощности из Home Assistant через REST API
- Каждую минуту обновляет данные из Home Assistant
- Отображает мощность на встроенном LCD экране с красивым интерфейсом
- Показывает статус подключения и время работы

## Преимущества REST API над MQTT

- ✅ При перезагрузке ESP32 сразу получает актуальное значение из HA
- ✅ Не нужно настраивать MQTT брокер
- ✅ Проще код, меньше зависимостей
- ✅ Надёжнее - не зависит от MQTT соединения

## Технические детали

- **Плата:** ESP32-C6 LCD (встроенный экран 172×320)
- **Библиотеки:** LVGL для графики, TFT_eSPI для дисплея
- **Протокол:** HTTP REST API
- **Обновление:** Каждую минуту

## Возможные проблемы

1. **Экран не работает:**
   - Проверь, что в `platformio.ini` указана правильная плата
   - Возможно, нужно настроить пины для дисплея в библиотеке TFT_eSPI

2. **WiFi не подключается:**
   - Проверь SSID и пароль
   - Убедись, что WiFi работает на 2.4 ГГц (ESP32-C6 не поддерживает 5 ГГц)

3. **Не получает данные из HA:**
   - Проверь IP адрес и порт Home Assistant
   - Проверь токен доступа
   - Проверь Entity ID сенсора

https://kaspi.kz/shop/p/modul-displeja-arduino-i2c-116737351/?ref=shared_link
